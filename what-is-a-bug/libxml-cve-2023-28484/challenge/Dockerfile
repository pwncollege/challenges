FROM ubuntu:24.04
RUN apt-get update && apt-get install -y autotools-dev autoconf libtool automake pkg-config make git python3
ADD --chown=0:0 --chmod=6755 http://github.com/pwncollege/exec-suid/releases/latest/download/exec-suid /usr/bin/exec-suid
COPY parse_xsd.c crash_to_flag.c /challenge/
RUN mkdir -p /challenge/bin;\
    cd /challenge;\ 
    git clone https://github.com/GNOME/libxml2 ./libxml;\
    git config --global user.email "you@example.com";\
    git config --global user.name "Your Name";\
    git -C libxml revert e4f85f1bd2eb34d9b49da9154a4cc3a1bc284f68;\
    git -C libxml diff HEAD^ > /challenge/patch.diff;\ 
    cd /challenge/libxml;\
    ./autogen.sh;\  
    ./configure --prefix=/challenge;\
    make -j$(nproc);\  
    make -j$(nproc) check;\
    make -j$(nproc) install;\
    rm /challenge/bin/*;\
    gcc -I/challenge/include/libxml2 -o /challenge/bin/parse_xsd /challenge/*.c -L/challenge/lib -Wl,-rpath=/challenge/lib -lxml2;\
    chmod 6755 /challenge/bin/parse_xsd


